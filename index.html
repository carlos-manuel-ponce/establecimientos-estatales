  <div id="modal-detalle" class="modal-detalle" style="display:none;">
    <div class="modal-contenido">
      <div class="modal-header" style="flex-direction:column;align-items:center;gap:0.5em;position:relative;">
        <img src="LOGO NUEVO COLOR_122003.png" alt="Logo San Luis - Ministerio de Educación" style="height:30px;max-width:400px;width:auto;display:block;margin:0 auto;">
      </div>
      <button id="cerrar-modal" style="background:#dc2626;color:white;border:none;padding:0.4rem 1rem;border-radius:6px;cursor:pointer;font-size:1.1em;position:absolute;top:18px;right:18px;z-index:1100;">×</button>
      <div id="modal-body"></div>
  <!-- Botones del modal generados dinámicamente por JS -->
    </div>
  </div>
  <style>
    .modal-detalle {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(27,42,65,0.75);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-contenido {
      background: #e0f7fa;
      border-radius: 18px;
      padding: 1.2rem 1.2rem 1rem 1.2rem;
      min-width: 340px;
      max-width: 830px;
      width: 96vw;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      position: relative;
      font-size: 1.01em;
      animation: modalIn 0.25s cubic-bezier(.4,2,.6,1) forwards;
      max-height: 80vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    }
    @keyframes modalIn {
      from { opacity: 0; transform: translateY(60px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.2em;
    }
    .modal-contenido label {
      font-weight: 600;
      color: #1B2A41;
      margin-top: 0.7em;
      margin-bottom: 0.7em;
      display: block;
    }
    .modal-body-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
  gap: 1em 0;
      width: 100%;
      margin-bottom: 1em;
    }
    @media (max-width: 900px) {
      .modal-body-grid {
        grid-template-columns: 1fr;
      }
    }
    .modal-contenido input, .modal-contenido select, .modal-contenido textarea {
      width: 100%;
      padding: 0.5em 0.8em;
      border-radius: 8px;
      border: 1px solid #b2ebf2;
      margin-top: 0.2em;
      margin-bottom: 0.7em;
      font-size: 1em;
      background: #e0f7fa;
    }
    .modal-contenido input[readonly], .modal-contenido textarea[readonly] {
      background: #b2ebf2;
      color: #555;
    }
  </style>
  <script>
    let modalEstablecimiento = null;
    function abrirModalDetalle(item) {
      modalEstablecimiento = {...item};
      const modal = document.getElementById('modal-detalle');
      const body = document.getElementById('modal-body');
      // Orden y columna personalizada
      const camposOrdenados = [
        {nombre:'categoria',col:'izq'},
        {nombre:'sector',col:'der'},
        {nombre:'denominacion',col:'izq'},
        {nombre:'region',col:'der'},
        {nombre:'nro',col:'izq'},
        {nombre:'nombre',col:'der'},
        {nombre:'localidad',col:'izq'},
        {nombre:'departamento',col:'der'},
        {nombre:'niveles',col:'izq'},
        {nombre:'modalidad',col:'der'},
        {nombre:'ambito',col:'izq'}
      ];
      let htmlIzq = '', htmlDer = '';
      camposOrdenados.forEach(obj => {
        const campo = obj.nombre;
        if (typeof item[campo] === 'undefined') return;
        const label = `<label style='width:100%;'>${campo.charAt(0).toUpperCase()+campo.slice(1)}<input type='text' name='${campo}' value="${item[campo]||''}" readonly></label>`;
        if(obj.col==='izq') htmlIzq += label;
        else htmlDer += label;
      });
      body.innerHTML = `<div style='display:grid;grid-template-columns:1fr 1fr;gap:1.1em 2em;width:100%;margin-bottom:1em;'>
        <div>${htmlIzq}</div>
        <div>${htmlDer}</div>
      </div>
      <div style='display:flex;justify-content:center;margin-top:1.2em;'>
        <button id='editar-modal' style='background:#1B2A41;color:white;border:none;padding:0.7rem 2.2rem;border-radius:8px;cursor:pointer;font-weight:600;'>Editar</button>
        <button id='guardar-modal' style='background:#56B4C6;color:white;border:none;padding:0.7rem 2.2rem;border-radius:8px;cursor:pointer;font-weight:600;display:none;margin-left:0.7em;'>Guardar</button>
      </div>`;
      modal.style.display = 'flex';
      document.getElementById('editar-modal').style.display = '';
      document.getElementById('guardar-modal').style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('cerrar-modal').onclick = ()=>{
        document.getElementById('modal-detalle').style.display = 'none';
      };
      // Delegar eventos para los botones del modal (ya que se regeneran)
      document.getElementById('modal-body').addEventListener('click', function(e) {
        if (e.target && e.target.id === 'editar-modal') {
          document.querySelectorAll('#modal-body input').forEach(inp=>inp.removeAttribute('readonly'));
          document.getElementById('editar-modal').style.display = 'none';
          document.getElementById('guardar-modal').style.display = '';
        }
        if (e.target && e.target.id === 'guardar-modal') {
          (async ()=>{
            const modal = document.getElementById('modal-detalle');
            const body = document.getElementById('modal-body');
            let datos = {};
            body.querySelectorAll('input').forEach(inp=>{
              datos[inp.name]=inp.value;
            });
            if (!modalEstablecimiento.id) { alert('No se puede editar: falta ID'); return; }
            const { error } = await supabaseClient
              .from('establecimientos')
              .update(datos)
              .eq('id', modalEstablecimiento.id);
            if (error) {
              alert('Error al guardar: '+error.message);
            } else {
              alert('Guardado correctamente');
              document.getElementById('modal-detalle').style.display = 'none';
              filtrarYMostrar();
            }
          })();
        }
      });
    });
  </script>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="logo-sl-transparente.png" />
  <!-- Montserrat Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dirección Gestión Educativa</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <style>
    :root {
      --azul-institucional: #1B2A41;
      --celeste: #56B4C6;
  --fondo-gradiente: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 60%, #80deea 100%);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Montserrat', 'Inter', sans-serif;
      background: var(--fondo-gradiente);
      color: #111827;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Montserrat', 'Inter', sans-serif;
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    th, .etiqueta, .carpeta button, .carpeta h3 {
      font-family: 'Montserrat', 'Inter', sans-serif;
      font-weight: 600;
    }

    /* Si quieres que todo el texto sea semi-bold, descomenta la siguiente línea */
    /* body, p, td, input, button, span, label { font-family: 'Montserrat', 'Inter', sans-serif; font-weight: 600; } */

    header {
      width: 100%;
      background: var(--azul-institucional);
      color: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    .header-content {
      max-width: 1300px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header img { height: 40px; }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 500;
      text-align: right;
    }

    .buscador {
      background: transparent;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: none;
      z-index: 1;
      color: #fff;
      margin-top: 1.25rem;
      margin-bottom: 1.25rem;
      padding: 1.5rem 0 1.2rem 0;
      border-radius: 0;
      position: relative;
    }

    .buscador input {
      width: 75%;
      max-width: 600px;
      padding: 0.8rem 1.2rem;
      border-radius: 50px;
      border: none;
      font-size: 1rem;
      transition: 0.3s ease;
      background: var(--azul-institucional);
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .buscador input:focus {
      outline: 2px solid #fff;
      box-shadow: 0 0 8px #2563eb99;
    }

    .container {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      box-sizing: border-box;
      padding: 0;
      overflow-x: hidden;
    }

    .carpetas-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
  gap: 2rem;
  padding: 2.25rem 1rem 3rem 1rem;
  width: 100%;
  box-sizing: border-box;
    }
    @media (max-width: 1200px) {
      .carpetas-container {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.2rem;
        padding: 2rem 0.5rem 2.5rem 0.5rem;
      }
    }
    @media (max-width: 900px) {
      .carpetas-container {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        padding: 1.5rem 0.2rem 2rem 0.2rem;
      }
    }
    @media (max-width: 600px) {
      .carpetas-container {
        grid-template-columns: 1fr;
        gap: 0.7rem;
        padding: 1rem 0.1rem 1.5rem 0.1rem;
      }
    }

    .carpeta {
      background: var(--azul-institucional);
      color: #fff;
      border-radius: 20px;
      padding: 2rem 1.2rem;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
      position: relative;
      line-height: 1.6;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      transform: translateY(40px);
      min-height: 220px;
      height: 100%;
      min-width: 0;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      box-sizing: border-box;
    }
    @media (max-width: 600px) {
      .carpeta {
        padding: 1.1rem 0.7rem;
        min-height: 160px;
      }
    }

    .carpeta.enter {
      animation: slideUp 0.7s ease forwards;
      animation-delay: var(--delay, 0ms);
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .carpeta:hover {
      transform: translate(16px, -6px) scale(1.03);
      box-shadow: 0 16px 32px 0 rgba(27,42,65,0.25), 0 0 0 4px #56B4C6aa;
      filter: brightness(1.08) saturate(1.2);
      transition: box-shadow 0.25s, filter 0.25s, transform 0.25s;
    }

    .etiqueta {
      position: absolute;
      top: -16px;
      left: 24px;
      background: #5EC5D1;
      color: #fff;
      font-weight: 600;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      font-size: 0.9rem;
    }

  .carpeta h3 { color: #fff; font-weight: 700; font-size: 1.3rem; margin-top: 1rem; }
  .carpeta p { color: #e5e7eb; font-size: 0.95rem; margin-top: 0.5rem; }

    .carpeta button {
      margin-top: 1rem;
      background: var(--celeste);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.4rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .carpeta button:hover { background: #3A98B2; }

    .listado {
      display: none;
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      padding: 1.5rem 0 2rem 0;
      overflow-x: auto;
      box-sizing: border-box;
      min-width: 0;
    }
    @media (max-width: 600px) {
      .listado {
        padding: 0.7rem 0.1rem 1rem 0.1rem;
        border-radius: 10px;
      }
    }

  .listado table {
      width: 100%;
      min-width: 600px;
      max-width: 1400px;
      margin: 0 auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 18px;
      overflow: visible;
      box-shadow: 0 2px 10px rgba(86,180,198,0.07);
      background: #fff;
      table-layout: auto;
      word-break: break-word;
      font-size: 1em;
    }
    @media (max-width: 900px) {
      .listado table {
        min-width: 400px;
        max-width: 100vw;
      }
    }
    @media (max-width: 600px) {
      .listado table {
        min-width: 320px;
        max-width: 100vw;
      }
    }
    @media (max-width: 600px) {
      .listado table {
        font-size: 0.93em;
        min-width: 220px;
      }
    }
    .listado th, .listado td {
      font-size: 12px;
      white-space: normal;
      text-overflow: initial;
      overflow: visible;
      max-width: none;
      vertical-align: middle;
      border: 1px solid #e5e7eb;
      word-break: break-word;
    }
    .listado tbody tr:nth-child(even) {
      background: #f3f4f6;
    }
    .listado tbody tr:nth-child(odd) {
      background: #e5e7eb;
    }
    .listado thead tr {
      background: var(--azul-institucional);
    }
    .listado td {
      font-size: 0.98em;
      padding-top: 0.7em;
      padding-bottom: 0.7em;
    }
  /* Se eliminan restricciones de ancho en media queries para que la tabla nunca se achique ni recorte campos */

    th, td {
      padding: 0.7rem 0.4rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      word-break: break-word;
    }
    @media (max-width: 600px) {
      th, td {
        padding: 0.5rem 0.2rem;
        font-size: 0.93em;
      }
    }

    th { background: var(--azul-institucional); color: white; }

  /* Eliminado: ya cubierto por los nuevos media queries */
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <img src="LOGO - MINISTERIO_032459.png" alt="Logo San Luis - Ministerio de Educación" />
  <h1><b>Dirección Gestión Educativa</b><br><span style="font-size:1rem; font-weight:300;">Establecimientos Estatales</span></h1>
    </div>
  </header>

  <div id="pregunta-buscador" style="display:flex;flex-direction:column;align-items:center;width:100%;margin-top:2.2em;margin-bottom:0.2em;">
    <div style="text-align:center;font-size:1.15em;font-weight:600;color:#1B2A41;margin-bottom:0.35em;">¿Qué establecimiento estás buscando?</div>
    <div class="buscador" id="buscador-bar" style="margin-top:0;margin-bottom:0.1em;">
      <input type="text" id="buscador" placeholder="Buscar carpeta, número o establecimiento..." onkeyup="buscarElemento()">
      <div id="buscador-resultados" style="width:75%;max-width:600px;left:0;right:0;margin:0 auto;position:absolute;z-index:10;top:100%;"></div>
    </div>
  </div>
  <!-- listado-bar eliminado: solo tabla en la vista de listado -->

  <div class="container" style="margin-top:2.2em;">
  <div id="inicio" class="carpetas-container">
  <div class="carpeta" data-denominacion="CENTRO EDUCATIVO"><div class="etiqueta">1</div><h3>Centros Educativos</h3><p>Listado de Centros Educativos.</p><button onclick="abrirListado('CENTRO EDUCATIVO')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA"><div class="etiqueta">2</div><h3>Escuelas</h3><p>Listado de Escuelas Provinciales.</p><button onclick="abrirListado('ESCUELA')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="COLEGIO"><div class="etiqueta">3</div><h3>Colegios</h3><p>Listado de Colegios Provinciales.</p><button onclick="abrirListado('COLEGIO')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA DE NIVEL INICIAL"><div class="etiqueta">4</div><h3>Escuelas de Nivel Inicial</h3><p>Listado de Escuelas de Nivel Inicial.</p><button onclick="abrirListado('ESCUELA DE NIVEL INICIAL')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA TÉCNICA"><div class="etiqueta">5</div><h3>Escuelas Técnicas</h3><p>Listado de Escuelas Técnicas.</p><button onclick="abrirListado('ESCUELA TÉCNICA')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA DE COMERCIO"><div class="etiqueta">6</div><h3>Escuelas de Comercio</h3><p>Listado de Escuelas de Comercio.</p><button onclick="abrirListado('ESCUELA DE COMERCIO')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="COLEGIO PARA ADULTOS"><div class="etiqueta">7</div><h3>Colegios para Adultos</h3><p>Listado de Colegios para Adultos.</p><button onclick="abrirListado('COLEGIO PARA ADULTOS')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA PARA ADULTOS"><div class="etiqueta">8</div><h3>Escuelas para Adultos</h3><p>Listado de Escuelas para Adultos.</p><button onclick="abrirListado('ESCUELA PARA ADULTOS')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <!-- Las siguientes categorías van al final -->
  <div class="carpeta" data-denominacion="ESCUELA DE EDUCACIÓN ESPECIAL"><div class="etiqueta">9</div><h3>Escuelas de Educación Especial</h3><p>Listado de Escuelas de Educación Especial.</p><button onclick="abrirListado('ESCUELA DE EDUCACIÓN ESPECIAL')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="CENTRO EDUCATIVO NIVEL SECUNDARIO"><div class="etiqueta">10</div><h3>Centro Educativo Nivel Secundario</h3><p>Listado de Centros Educativos Nivel Secundario.</p><button onclick="abrirListado('CENTRO EDUCATIVO NIVEL SECUNDARIO')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA DE JORNADA COMPLETA"><div class="etiqueta">11</div><h3>Escuelas de Jornada Completa</h3><p>Listado de Escuelas de Jornada Completa.</p><button onclick="abrirListado('ESCUELA DE JORNADA COMPLETA')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <div class="carpeta" data-denominacion="ESCUELA SECUNDARIA DE ARTE"><div class="etiqueta">12</div><h3>Escuelas Secundarias de Arte</h3><p>Listado de Escuelas Secundarias de Arte.</p><button onclick="abrirListado('ESCUELA SECUNDARIA DE ARTE')">Abrir Listado</button><span class="total-carpeta" style="display:block;margin-top:0.7em;font-size:1.08em;color:#56B4C6;font-weight:600;"></span></div>
  <script>
    // ...existing code...
    // Mostrar totales en cada carpeta
    document.addEventListener('DOMContentLoaded', async () => {
      const denominaciones = [
        'CENTRO EDUCATIVO',
        'ESCUELA',
        'COLEGIO',
        'ESCUELA DE NIVEL INICIAL',
        'ESCUELA DE EDUCACIÓN ESPECIAL',
        'CENTRO EDUCATIVO NIVEL SECUNDARIO',
        'ESCUELA TÉCNICA',
        'ESCUELA DE JORNADA COMPLETA',
        'ESCUELA DE COMERCIO',
        'COLEGIO PARA ADULTOS',
        'ESCUELA SECUNDARIA DE ARTE',
        'ESCUELA PARA ADULTOS'
      ];
      const { data, error } = await supabaseClient
        .from('establecimientos')
        .select('denominacion');
      if (!error && data) {
        denominaciones.forEach(denom => {
          const total = data.filter(e => e.denominacion === denom).length;
          const card = document.querySelector(`.carpeta[data-denominacion="${denom}"] .total-carpeta`);
          if (card) card.textContent = `Total: ${total}`;
        });
      }
    });
  </script>
    </div>

    <section id="listado" class="listado" style="box-shadow:none;border-radius:0;margin-top:0;padding:0 0 0 0;background:transparent;">
  <div style="width:98%;max-width:1400px;margin:1.5em auto 0 auto;padding:1.1em 1.2em 1.1em 1.2em;background:#e0f7fa;border-radius:16px;box-shadow:0 2px 10px #56B4C633;display:flex;flex-direction:column;align-items:stretch;gap:1em;margin-bottom:0.7em;border:1.5px solid #b2ebf2;">
    <div style="display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%;gap:1em;">
      <div id="listado-titulo" style="font-size:1.35em;font-weight:700;color:#1B2A41;white-space:nowrap;"></div>
      <div id="filtros-listado" style="display:flex;gap:1.5em;justify-content:center;align-items:center;">
        <label style="font-weight:600;color:#1B2A41;">Categoría:
          <select id="filtro-categoria-listado" style="margin-left:0.5em;padding:0.3em 0.7em;border-radius:6px;border:1px solid #b2ebf2;font-size:1em;background:#e0f7fa;color:#1B2A41;">
            <option value="">Todas</option>
          </select>
        </label>
        <label style="font-weight:600;color:#1B2A41;">Región:
          <select id="filtro-region-listado" style="margin-left:0.5em;padding:0.3em 0.7em;border-radius:6px;border:1px solid #b2ebf2;font-size:1em;background:#e0f7fa;color:#1B2A41;">
            <option value="">Todas</option>
          </select>
        </label>
      </div>
      <button id="cerrar-listado" style="background:#dc2626;color:white;border:none;padding:0.5em 1.2em;border-radius:8px;font-size:1em;font-weight:600;cursor:pointer;">Cerrar</button>
    </div>
  <div id="listado-tabla" style="padding:0;display:flex;justify-content:center;flex-direction:column;align-items:center;margin-top:0.2em;">
  <table id="tabla-establecimientos" style="width:98%;max-width:1400px;border-radius:22px;overflow:hidden;box-shadow:0 6px 24px rgba(27,42,65,0.18);background:var(--azul-institucional);margin:0 auto;border:1.2px solid #b2ebf2;">
          <thead style="position:sticky;top:0;z-index:2;background:var(--azul-institucional);">
            <tr>
               <th style="background:var(--azul-institucional);color:#fff;font-size:1.13em;padding:1.2em 0.7em;border:none;text-align:center;">Categoría</th>
               <th style="background:var(--azul-institucional);color:#fff;font-size:1.13em;padding:1.2em 0.7em;border:none;text-align:center;">Región</th>
               <th style="background:var(--azul-institucional);color:#fff;font-size:1.13em;padding:1.2em 0.7em;border:none;text-align:center;">Denominación</th>
               <th style="background:var(--azul-institucional);color:#fff;font-size:1.13em;padding:1.2em 0.7em;border:none;text-align:center;">N°</th>
               <th style="background:var(--azul-institucional);color:#fff;font-size:1.13em;padding:1.2em 0.7em;border:none;text-align:center;">Nombre</th>
            </tr>
          </thead>
          <tbody id="tabla-body" style="background:var(--azul-institucional);">
            <tr><td colspan='5' style='text-align:center;color:#e5e7eb;'>Seleccione una carpeta para ver los establecimientos.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    const supabaseUrl = 'https://csbcfhwdpstnofvsfqwh.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzYmNmaHdkcHN0bm9mdnNmcXdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMjkzODcsImV4cCI6MjA3MTcwNTM4N30.lX166U64tFeqKd6snFduL-oXWD_LXwzPMyQYVF3g8ek';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  let datosActuales = [];
  let tipoActual = '';

    async function abrirListado(tipo) {
      document.getElementById('inicio').style.display = 'none';
      document.getElementById('pregunta-buscador').style.display = 'none';
      const listado = document.getElementById('listado');
      listado.style.display = 'block';
      tipoActual = tipo;

      // Mostrar el título de la carpeta
      // Mostrar el título de la carpeta en plural
      let titulo = tipo.trim();
      // Si termina en vocal, agrega 's', si termina en consonante agrega 'es', si ya es plural no cambia
      if (!/s$/i.test(titulo)) {
        if (/[aeiouáéíóú]$/i.test(titulo)) {
          titulo += 's';
        } else {
          titulo += 'es';
        }
      }
      document.getElementById('listado-titulo').textContent = titulo.charAt(0).toUpperCase() + titulo.slice(1).toLowerCase();

      const tbody = document.getElementById('tabla-body');
      tbody.innerHTML = `<tr><td colspan='10' style='text-align:center;color:#6b7280;'>Cargando datos...</td></tr>`;

      const { data, error } = await supabaseClient
        .from('establecimientos')
        .select('*')
        .eq('denominacion', tipo.toUpperCase());

      if (error) {
        tbody.innerHTML = `<tr><td colspan='11' style='color:red;text-align:center;'>Error al cargar los datos</td></tr>`;
        console.error(error);
        return;
      }

      datosActuales = data || [];
      filtrarYMostrar();
      // Llenar filtros de categoría y región
      setTimeout(()=>{
        const selectCat = document.getElementById('filtro-categoria-listado');
        const selectReg = document.getElementById('filtro-region-listado');
        if (selectCat && selectReg) {
          // Categoría
          const categorias = [...new Set((data||[]).map(e=>e.categoria).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'es',{sensitivity:'base'}));
          selectCat.innerHTML = '<option value="">Todas</option>' + categorias.map(cat=>`<option value="${cat}">${cat}</option>`).join('');
          // Región
          const regiones = [...new Set((data||[]).map(e=>e.region).filter(Boolean))].sort((a,b)=>a.localeCompare(b,'es',{sensitivity:'base'}));
          selectReg.innerHTML = '<option value="">Todas</option>' + regiones.map(reg=>`<option value="${reg}">${reg}</option>`).join('');
          selectCat.onchange = filtrarYMostrar;
          selectReg.onchange = filtrarYMostrar;
        }
      }, 0);
    }

    // Filtros eliminados
// actualizarContadores eliminado: ya no hay contador en la interfaz
    function filtrarYMostrar() {
      const tbody = document.getElementById('tabla-body');
      let filtrados = datosActuales;
      // Filtros de categoría y región
      const selectCat = document.getElementById('filtro-categoria-listado');
      const selectReg = document.getElementById('filtro-region-listado');
      if (selectCat && selectCat.value) {
        filtrados = filtrados.filter(e => e.categoria === selectCat.value);
      }
      if (selectReg && selectReg.value) {
        filtrados = filtrados.filter(e => e.region === selectReg.value);
      }
      // Ordenar por nro de menor a mayor (numérico)
      filtrados = [...filtrados].sort((a, b) => {
        if (a.nro == null && b.nro == null) return 0;
        if (a.nro == null) return 1;
        if (b.nro == null) return -1;
        const na = isNaN(Number(a.nro)) ? a.nro : Number(a.nro);
        const nb = isNaN(Number(b.nro)) ? b.nro : Number(b.nro);
        if (typeof na === 'number' && typeof nb === 'number') return na - nb;
        return String(na).localeCompare(String(nb), 'es', {numeric:true});
      });
      if (!filtrados || filtrados.length === 0) {
        tbody.innerHTML = `<tr><td colspan='5' style='text-align:center;color:#6b7280;'>No se encontraron registros para ${tipoActual}</td></tr>`;
        return;
      }
      tbody.innerHTML = filtrados.map((item, idx) => `
        <tr class="fila-establecimiento" data-idx="${idx}" style="cursor:pointer;transition:background 0.18s;">
          <td style="color:#1B2A41;font-size:1.04em;border:none;text-align:center;">${item.categoria || ''}</td>
          <td style="color:#1B2A41;font-size:1.04em;border:none;text-align:center;">${item.region || ''}</td>
          <td style="color:#1B2A41;font-size:1.04em;border:none;text-align:center;">${item.denominacion || ''}</td>
          <td style="color:#1B2A41;font-size:1.04em;border:none;text-align:center;">${item.nro || ''}</td>
          <td style="color:#1B2A41;font-size:1.04em;border:none;text-align:center;">${item.nombre || ''}</td>
        </tr>`).join('');
      // Efecto hover moderno azul-celeste
      document.querySelectorAll('.fila-establecimiento').forEach(row => {
        row.addEventListener('mouseenter', function() {
          this.style.background = '#56B4C6';
        });
        row.addEventListener('mouseleave', function() {
          this.style.background = '';
        });
        row.addEventListener('click', function() {
          const idx = this.getAttribute('data-idx');
          abrirModalDetalle(filtrados[idx]);
        });
      });
    }

    function cargarCategorias() {
      const select = document.getElementById('filtro-categoria');
      const categorias = [...new Set(datosActuales.map(item => item.categoria).filter(Boolean))].sort((a, b) => a.localeCompare(b, 'es', {sensitivity:'base'}));
      select.innerHTML = '<option value="">Todas las categorías</option>' + categorias.map(cat => `<option value="${cat}">${cat}</option>`).join('');
      select.onchange = filtrarYMostrar;
    }

  // Filtros eliminados: no se agregan listeners

    function volverInicio() {
      document.getElementById('listado').style.display = 'none';
      document.getElementById('pregunta-buscador').style.display = 'flex';
      const inicio = document.getElementById('inicio');
      inicio.style.display = 'grid';
      triggerGridAnimation();
    }

    async function buscarElemento() {
      const filtro = document.getElementById('buscador').value.toLowerCase();
      const carpetas = document.querySelectorAll('.carpeta');
      let coincidencias = [];
      // Filtrar carpetas por nombre o número
      carpetas.forEach(carpeta => {
        const texto = carpeta.textContent.toLowerCase();
        const etiqueta = carpeta.querySelector('.etiqueta')?.textContent.toLowerCase() || '';
        if (texto.includes(filtro) || etiqueta.includes(filtro)) {
          carpeta.style.display = 'block';
        } else {
          carpeta.style.display = 'none';
        }
      });

      // Buscar en la base de datos si hay coincidencia con un establecimiento
      const resultadosDiv = document.getElementById('buscador-resultados');
      resultadosDiv.innerHTML = '';
      if (filtro.length > 2) {
        // Buscar por nombre o número en la base de datos (insensible a mayúsculas/minúsculas)
        const { data, error } = await supabaseClient
          .from('establecimientos')
          .select('nombre, nro, denominacion')
          .or(`nombre.ilike.%${filtro}%,nro.ilike.%${filtro}%`);
        if (!error && data && data.length > 0) {
          // Solo agrupar por las denominaciones permitidas
          const denominacionesPermitidas = [
            'CENTRO EDUCATIVO',
            'ESCUELA',
            'COLEGIO',
            'ESCUELA DE NIVEL INICIAL',
            'ESCUELA DE EDUCACIÓN ESPECIAL',
            'CENTRO EDUCATIVO NIVEL SECUNDARIO',
            'ESCUELA TÉCNICA',
            'ESCUELA DE JORNADA COMPLETA',
            'ESCUELA DE COMERCIO',
            'COLEGIO PARA ADULTOS',
            'ESCUELA SECUNDARIA DE ARTE',
            'ESCUELA PARA ADULTOS'
          ];
          const agrupado = {};
          data.forEach(est => {
            // Coincidencia parcial en nombre o nro y denominacion válida
            if (
              denominacionesPermitidas.includes(est.denominacion) &&
              ((est.nombre && est.nombre.toLowerCase().includes(filtro)) || (est.nro && String(est.nro).toLowerCase().includes(filtro)))
            ) {
              if (!agrupado[est.denominacion]) agrupado[est.denominacion] = [];
              agrupado[est.denominacion].push(est);
            }
          });
          if (Object.keys(agrupado).length > 0) {
            resultadosDiv.innerHTML = '<div style="background:#fff;border-radius:10px;box-shadow:0 2px 8px #0001;padding:1em 1.2em;margin-top:0.5em;">' +
              '<b>Coincidencias encontradas:</b><ul style="margin:0.5em 0 0 1em;padding:0;">' +
              Object.entries(agrupado).map(([carpeta, ests]) =>
                `<li><b>${carpeta}</b>: ${ests.map(e => `${e.nombre} <span style='color:#888'>(N° ${e.nro})</span>`).join(', ')}</li>`
              ).join('') +
              '</ul></div>';
          }
        }
      }
    }

    function triggerGridAnimation() {
      const cards = document.querySelectorAll('.carpeta');
      cards.forEach((card, i) => {
        card.classList.remove('enter');
        card.style.animation = 'none';
        void card.offsetWidth;
        card.style.removeProperty('animation');
        card.style.setProperty('--delay', (i * 90) + 'ms');
        card.classList.add('enter');
      });
    }

    document.addEventListener('DOMContentLoaded', triggerGridAnimation);

    // Botón cerrar listado
    document.addEventListener('DOMContentLoaded', () => {
      const btnCerrar = document.getElementById('cerrar-listado');
      if (btnCerrar) {
        btnCerrar.onclick = volverInicio;
      }
    });
  </script>

  <footer style="width:100%;margin-top:2.5em;padding:1.2em 0 1.2em 0;background:var(--azul-institucional);color:#fff;text-align:center;font-size:1.08em;letter-spacing:0.5px;">
    © Ministerio de Educación. Gobierno de la Provincia de San Luis
  </footer>
</body>
</html>
